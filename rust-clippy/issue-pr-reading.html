<!DOCTYPE html><html><head><link rel="icon shortcut" href="/favicon.png"/><meta http-equiv="Content-Type" content="text/html" charSet="UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>IssueとPRを読む</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/f65c36dfe6831194.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f65c36dfe6831194.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f494479e1a89519f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f494479e1a89519f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-243158fe274fe2cd.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-f32d95d8c858a7b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9bbeff8c38d04d52.js" defer=""></script><script src="/_next/static/chunks/226-ba96346710649ee0.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bbook%5D/%5B...article%5D-6fcfac185874bf64.js" defer=""></script><script src="/_next/static/YUhJxocG7btAlZOyC1lft/_buildManifest.js" defer=""></script><script src="/_next/static/YUhJxocG7btAlZOyC1lft/_ssgManifest.js" defer=""></script><script src="/_next/static/YUhJxocG7btAlZOyC1lft/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class=""><main class=""><div class="flex"><div style="width:300px;display:block" class="h-screen fixed bg-gray-100"><nav class="maido-list pt-5 pl-3"><ul>
<li><a href="/rust-clippy/">rust-lang/rust-clippyをさわる</a></li>
<li><a href="/rust-clippy/contributing-guide-reading/index/">Contributing to Clippy を読む</a></li>
<li><a href="/rust-clippy/issue-pr-reading/index/">IssueとPRを読む</a></li>
</ul>
</nav><div id="list-resize-handler" style="cursor:move;left:295px;width:5px;transform:translate(0px,0px)" class="top-0 bottom-0 h-screen fixed react-draggable"></div></div><div style="padding-left:300px;padding-right:300px" class="w-full h-screen"><div class="w-full relative flex space-x-4 justify-center pb-5"><div class="pl-2 pt-7 left-0"><button class="font-medium"><img src="/left-arrow.svg" alt="toggle" width="30" height="30"/></button></div><div class="w-full text-center pt-5"><h1 class="text-3xl underline"><a href="/">pub.docs</a></h1></div><div class="pr-2 pt-7 right-0"><button class="text-xl"><img src="/right-arrow.svg" alt="toggle" width="30" height="30"/></button></div></div><div class="maido-content px-5 pb-20"><h1 id="issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80" tabindex="-1"><a class="header-anchor" href="#issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80">#</a> IssueとPRを読む</h1>
<h2 id="issue-%237826" tabindex="-1"><a class="header-anchor" href="#issue-%237826">#</a> Issue <a href="https://github.com/rust-lang/rust-clippy/issues/7826">#7826</a></h2>
<blockquote>
<p>will machine readable format be added? or is there already one?</p>
</blockquote>
<p>質問タイプ。エラーメッセージやlinterの出力を人間フレンドリーでなく機械フレンドリーなものはありますか？という疑問。</p>
<p>回答として、<a href="https://doc.rust-lang.org/rustc/json.html">rustc book / JSON output</a>があげられているので読んでみる。</p>
<p>rustcによって出力されるJSON。これは <code>--error-format=json</code> flagをつけることで出てくる。</p>
<p><strong>実際に unused variable でJSON形式でエラーを出してみた。</strong></p>
<p>挙動</p>
<ul>
<li>正常にコンパイルされエラーが出ないならばJSONも出力されない(空の<code>{}</code>すら出てこない)</li>
<li>メッセージが出るならば、メッセージひと単位あたりひとつのJSONが出力される。区切り文字は改行のようだった。このメッセージは <a href="https://github.com/oli-obk/cargo_metadata">cargo_metadata</a> を用いてパースしたりできるらしい。</li>
</ul>
<pre><code class="language-rust:main.rs">fn main() {
  println!("HELLO: {}", 123);
  let x = 1234; // unused value
}
</code></pre>
<pre><code class="language-json:message-1">{"message":"unused variable: `x`","code":{"code":"unused_variables","explanation":null},"level":"warning","spans":[{"file_name":"main.rs","byte_start":48,"byte_end":49,"line_start":3,"line_end":3,"column_start":7,"column_end":8,"is_primary":true,"text":[{"text":"  let x = 1234; // unused value","highlight_start":7,"highlight_end":8}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[{"message":"`#[warn(unused_variables)]` on by default","code":null,"level":"note","spans":[],"children":[],"rendered":null},{"message":"if this is intentional, prefix it with an underscore","code":null,"level":"help","spans":[{"file_name":"main.rs","byte_start":48,"byte_end":49,"line_start":3,"line_end":3,"column_start":7,"column_end":8,"is_primary":true,"text":[{"text":"  let x = 1234; // unused value","highlight_start":7,"highlight_end":8}],"label":null,"suggested_replacement":"_x","suggestion_applicability":"MachineApplicable","expansion":null}],"children":[],"rendered":null}],"rendered":"warning: unused variable: `x`\n --&gt; main.rs:3:7\n  |\n3 |   let x = 1234; // unused value\n  |       ^ help: if this is intentional, prefix it with an underscore: `_x`\n  |\n  = note: `#[warn(unused_variables)]` on by default\n\n"}
</code></pre>
<pre><code class="language-json:message-2">{"message":"1 warning emitted","code":null,"level":"warning","spans":[],"children":[],"rendered":"warning: 1 warning emitted\n\n"}
</code></pre>
<p><img src="/assets/home/runner/work/pub.docs/pub.docs/content/rust-clippy/issue-pr-reading/index.md/image-1.jpg" alt="image-1"></p>
<h2 id="issue-%237934" tabindex="-1"><a class="header-anchor" href="#issue-%237934">#</a> Issue <a href="https://github.com/rust-lang/rust-clippy/issues/7934">#7934</a></h2>
<blockquote>
<p>ICE with <code>clippy::undocumented_unsafe_blocks</code></p>
</blockquote>
<p><a href="https://github.com/rust-lang/portable-simd">portable-simd</a>でICE(Internal Compile Error)が起きる。</p>
<p>これrustcの問題では？と思ったが、報告されているエラーメッセージには以下のようにclippyに報告するように書いてある。</p>
<pre><code>error: internal compiler error: unexpected panic

note: the compiler unexpectedly panicked. this is a bug.

note: we would appreciate a bug report: https://github.com/rust-lang/rust-clippy/issues/new
</code></pre>
<p>MCVE(Minimal Complete and Verifiable Example ようは条件を満たす最小単位のこと、この場合だとICEになる最小再現コード)が提示されている。試してみる。</p>
<p>stableでは再現しなかった。nightlyを入れて <code>rustup run nightly cargo run</code> してもこのバージョンより新しいから(おそらく修正済みになっており)再現しなかった。</p>
<p><img src="/assets/home/runner/work/pub.docs/pub.docs/content/rust-clippy/issue-pr-reading/index.md/image-2.jpg" alt="image-2"></p>
<p>関連して PR <a href="https://github.com/rust-lang/rust-clippy/pull/7945">#7945</a> を読む。</p>
<h2 id="pr-%237945" tabindex="-1"><a class="header-anchor" href="#pr-%237945">#</a> PR <a href="https://github.com/rust-lang/rust-clippy/pull/7945">#7945</a></h2>
<blockquote>
<p>Fix ICE in undocumented_unsafe_blocks</p>
</blockquote>
<p>Issue <a href="https://github.com/rust-lang/rust-clippy/issues/7934">#7934</a> の解決PR。</p>
<p>MCVEはテストに利用されるみたい。clippyでは <code>tests/ui/crashes</code> にICEが置かれるのかな。 auxiliary というディレクトリがある。auxiliaryは意味的に補助ということらしい？uiはどういう意味なんだろう。おそらく、複数ファイルによるtestは補助ディレクトリに<code>main.rs</code>以外を置いて<code>tests/ui/crashes</code>以下に<code>main.rs</code>を<code>ice-&lt;number&gt;</code>の形で置いているみたい？</p>
<p>UIテストについては <a href="https://rustc-dev-guide.rust-lang.org/tests/adding.html#ui">rustc-dev-guide/Guide to the UI tests</a>に記述がある。UIの名前が意味するところは分からなかった。</p>
<p><a href="https://github.com/rust-lang/rust-clippy/tree/master/clippy_lints/src">rust-clippyのclippy_lints/src以下</a> にruleがめちゃ置いてある。今回はこの中のlintのルールのひとつである <code>undocumented_unsafe_blocks</code> が修正されている。このルールは PR <a href="https://github.com/rust-lang/rust-clippy/pull/7748">#7748</a> で追加されている。このlintは2人が別々に実装し結局こっちが採用された経緯があるみたい。確かにOSSで実装がバッティングしちゃうのはありそう。</p>
<h2 id="pr-%237748" tabindex="-1"><a class="header-anchor" href="#pr-%237748">#</a> PR <a href="https://github.com/rust-lang/rust-clippy/pull/7748">#7748</a></h2>
<blockquote>
<p>Add undocumented_unsafe_blocks lint</p>
</blockquote>
<p>unsafeブロックでドキュメントコメントが書かれてないなら警告を出すlint ruleの追加PR。</p>
</div></div><div style="width:300px;display:block" class="h-screen fixed bg-gray-100 right-0"><nav class="maido-toc pt-5 pl-3"><nav class="table-of-contents"><ol><li><a href="#issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80"> IssueとPRを読む</a><ol><li><a href="#issue-%237826"> Issue #7826</a></li><li><a href="#issue-%237934"> Issue #7934</a></li><li><a href="#pr-%237945"> PR #7945</a></li><li><a href="#pr-%237748"> PR #7748</a></li></ol></li></ol></nav></nav><div id="toc-resize-handler" style="cursor:move;right:295px;width:5px;transform:translate(0px,0px)" class="absolute top-0 bottom-0 h-screen fixed react-draggable"></div></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"projectTitle":"pub.docs","meta":{"title":"IssueとPRを読む","date":"2022-02-03T21:50:49+09:00","draft":false},"list":"\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/rust-clippy/\"\u003erust-lang/rust-clippyをさわる\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/rust-clippy/contributing-guide-reading/index/\"\u003eContributing to Clippy を読む\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/rust-clippy/issue-pr-reading/index/\"\u003eIssueとPRを読む\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","content":"\u003ch1 id=\"issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80\" tabindex=\"-1\"\u003e\u003ca class=\"header-anchor\" href=\"#issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80\"\u003e#\u003c/a\u003e IssueとPRを読む\u003c/h1\u003e\n\u003ch2 id=\"issue-%237826\" tabindex=\"-1\"\u003e\u003ca class=\"header-anchor\" href=\"#issue-%237826\"\u003e#\u003c/a\u003e Issue \u003ca href=\"https://github.com/rust-lang/rust-clippy/issues/7826\"\u003e#7826\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003ewill machine readable format be added? or is there already one?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e質問タイプ。エラーメッセージやlinterの出力を人間フレンドリーでなく機械フレンドリーなものはありますか？という疑問。\u003c/p\u003e\n\u003cp\u003e回答として、\u003ca href=\"https://doc.rust-lang.org/rustc/json.html\"\u003erustc book / JSON output\u003c/a\u003eがあげられているので読んでみる。\u003c/p\u003e\n\u003cp\u003erustcによって出力されるJSON。これは \u003ccode\u003e--error-format=json\u003c/code\u003e flagをつけることで出てくる。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e実際に unused variable でJSON形式でエラーを出してみた。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e挙動\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e正常にコンパイルされエラーが出ないならばJSONも出力されない(空の\u003ccode\u003e{}\u003c/code\u003eすら出てこない)\u003c/li\u003e\n\u003cli\u003eメッセージが出るならば、メッセージひと単位あたりひとつのJSONが出力される。区切り文字は改行のようだった。このメッセージは \u003ca href=\"https://github.com/oli-obk/cargo_metadata\"\u003ecargo_metadata\u003c/a\u003e を用いてパースしたりできるらしい。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-rust:main.rs\"\u003efn main() {\n  println!(\"HELLO: {}\", 123);\n  let x = 1234; // unused value\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-json:message-1\"\u003e{\"message\":\"unused variable: `x`\",\"code\":{\"code\":\"unused_variables\",\"explanation\":null},\"level\":\"warning\",\"spans\":[{\"file_name\":\"main.rs\",\"byte_start\":48,\"byte_end\":49,\"line_start\":3,\"line_end\":3,\"column_start\":7,\"column_end\":8,\"is_primary\":true,\"text\":[{\"text\":\"  let x = 1234; // unused value\",\"highlight_start\":7,\"highlight_end\":8}],\"label\":null,\"suggested_replacement\":null,\"suggestion_applicability\":null,\"expansion\":null}],\"children\":[{\"message\":\"`#[warn(unused_variables)]` on by default\",\"code\":null,\"level\":\"note\",\"spans\":[],\"children\":[],\"rendered\":null},{\"message\":\"if this is intentional, prefix it with an underscore\",\"code\":null,\"level\":\"help\",\"spans\":[{\"file_name\":\"main.rs\",\"byte_start\":48,\"byte_end\":49,\"line_start\":3,\"line_end\":3,\"column_start\":7,\"column_end\":8,\"is_primary\":true,\"text\":[{\"text\":\"  let x = 1234; // unused value\",\"highlight_start\":7,\"highlight_end\":8}],\"label\":null,\"suggested_replacement\":\"_x\",\"suggestion_applicability\":\"MachineApplicable\",\"expansion\":null}],\"children\":[],\"rendered\":null}],\"rendered\":\"warning: unused variable: `x`\\n --\u0026gt; main.rs:3:7\\n  |\\n3 |   let x = 1234; // unused value\\n  |       ^ help: if this is intentional, prefix it with an underscore: `_x`\\n  |\\n  = note: `#[warn(unused_variables)]` on by default\\n\\n\"}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-json:message-2\"\u003e{\"message\":\"1 warning emitted\",\"code\":null,\"level\":\"warning\",\"spans\":[],\"children\":[],\"rendered\":\"warning: 1 warning emitted\\n\\n\"}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/home/runner/work/pub.docs/pub.docs/content/rust-clippy/issue-pr-reading/index.md/image-1.jpg\" alt=\"image-1\"\u003e\u003c/p\u003e\n\u003ch2 id=\"issue-%237934\" tabindex=\"-1\"\u003e\u003ca class=\"header-anchor\" href=\"#issue-%237934\"\u003e#\u003c/a\u003e Issue \u003ca href=\"https://github.com/rust-lang/rust-clippy/issues/7934\"\u003e#7934\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eICE with \u003ccode\u003eclippy::undocumented_unsafe_blocks\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/rust-lang/portable-simd\"\u003eportable-simd\u003c/a\u003eでICE(Internal Compile Error)が起きる。\u003c/p\u003e\n\u003cp\u003eこれrustcの問題では？と思ったが、報告されているエラーメッセージには以下のようにclippyに報告するように書いてある。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust-clippy/issues/new\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMCVE(Minimal Complete and Verifiable Example ようは条件を満たす最小単位のこと、この場合だとICEになる最小再現コード)が提示されている。試してみる。\u003c/p\u003e\n\u003cp\u003estableでは再現しなかった。nightlyを入れて \u003ccode\u003erustup run nightly cargo run\u003c/code\u003e してもこのバージョンより新しいから(おそらく修正済みになっており)再現しなかった。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/home/runner/work/pub.docs/pub.docs/content/rust-clippy/issue-pr-reading/index.md/image-2.jpg\" alt=\"image-2\"\u003e\u003c/p\u003e\n\u003cp\u003e関連して PR \u003ca href=\"https://github.com/rust-lang/rust-clippy/pull/7945\"\u003e#7945\u003c/a\u003e を読む。\u003c/p\u003e\n\u003ch2 id=\"pr-%237945\" tabindex=\"-1\"\u003e\u003ca class=\"header-anchor\" href=\"#pr-%237945\"\u003e#\u003c/a\u003e PR \u003ca href=\"https://github.com/rust-lang/rust-clippy/pull/7945\"\u003e#7945\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFix ICE in undocumented_unsafe_blocks\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIssue \u003ca href=\"https://github.com/rust-lang/rust-clippy/issues/7934\"\u003e#7934\u003c/a\u003e の解決PR。\u003c/p\u003e\n\u003cp\u003eMCVEはテストに利用されるみたい。clippyでは \u003ccode\u003etests/ui/crashes\u003c/code\u003e にICEが置かれるのかな。 auxiliary というディレクトリがある。auxiliaryは意味的に補助ということらしい？uiはどういう意味なんだろう。おそらく、複数ファイルによるtestは補助ディレクトリに\u003ccode\u003emain.rs\u003c/code\u003e以外を置いて\u003ccode\u003etests/ui/crashes\u003c/code\u003e以下に\u003ccode\u003emain.rs\u003c/code\u003eを\u003ccode\u003eice-\u0026lt;number\u0026gt;\u003c/code\u003eの形で置いているみたい？\u003c/p\u003e\n\u003cp\u003eUIテストについては \u003ca href=\"https://rustc-dev-guide.rust-lang.org/tests/adding.html#ui\"\u003erustc-dev-guide/Guide to the UI tests\u003c/a\u003eに記述がある。UIの名前が意味するところは分からなかった。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/rust-lang/rust-clippy/tree/master/clippy_lints/src\"\u003erust-clippyのclippy_lints/src以下\u003c/a\u003e にruleがめちゃ置いてある。今回はこの中のlintのルールのひとつである \u003ccode\u003eundocumented_unsafe_blocks\u003c/code\u003e が修正されている。このルールは PR \u003ca href=\"https://github.com/rust-lang/rust-clippy/pull/7748\"\u003e#7748\u003c/a\u003e で追加されている。このlintは2人が別々に実装し結局こっちが採用された経緯があるみたい。確かにOSSで実装がバッティングしちゃうのはありそう。\u003c/p\u003e\n\u003ch2 id=\"pr-%237748\" tabindex=\"-1\"\u003e\u003ca class=\"header-anchor\" href=\"#pr-%237748\"\u003e#\u003c/a\u003e PR \u003ca href=\"https://github.com/rust-lang/rust-clippy/pull/7748\"\u003e#7748\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAdd undocumented_unsafe_blocks lint\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eunsafeブロックでドキュメントコメントが書かれてないなら警告を出すlint ruleの追加PR。\u003c/p\u003e\n","toc":"\u003cnav class=\"table-of-contents\"\u003e\u003col\u003e\u003cli\u003e\u003ca href=\"#issue%E3%81%A8pr%E3%82%92%E8%AA%AD%E3%82%80\"\u003e IssueとPRを読む\u003c/a\u003e\u003col\u003e\u003cli\u003e\u003ca href=\"#issue-%237826\"\u003e Issue #7826\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#issue-%237934\"\u003e Issue #7934\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#pr-%237945\"\u003e PR #7945\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#pr-%237748\"\u003e PR #7748\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e"},"__N_SSG":true},"page":"/[book]/[...article]","query":{"book":"rust-clippy","article":["issue-pr-reading"]},"buildId":"YUhJxocG7btAlZOyC1lft","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>